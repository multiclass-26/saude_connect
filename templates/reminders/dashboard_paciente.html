{% extends 'base.html' %}
{% load static %}

{% block body_class %}bg-paciente{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
        <div>
            <h1 style="font-size: 2rem; margin-bottom: 0.5rem; color: var(--accent-dark);">Minha Saúde</h1>
            <p style="color: var(--text-secondary); font-size: 1.1rem;">Olá, {{ user.first_name }}! Cuide-se bem hoje.</p>
        </div>
        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
            <a href="{% url 'lembretes' %}" class="btn" style="background: var(--accent); color: white; text-decoration: none; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 600; box-shadow: 0 2px 8px rgba(0, 217, 181, 0.2); transition: all 0.2s;">
                <i class="fas fa-bell"></i> Notificações
            </a>
            <a href="{% url 'perfil' %}" class="btn" style="background: white; border: 2px solid var(--accent); color: var(--accent-dark); text-decoration: none; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 600; transition: all 0.2s;">
                <i class="fas fa-user"></i> Perfil
            </a>
            <a href="{% url 'mapa' %}" class="btn" style="background: var(--success); color: white; text-decoration: none; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 600; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2); transition: all 0.2s;">
                <i class="fas fa-map-marked-alt"></i> Mapa
            </a>
            <a href="{% url 'comunidade' %}" class="btn" style="background: var(--accent); color: white; text-decoration: none; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 600; box-shadow: 0 2px 8px rgba(0, 217, 181, 0.2); transition: all 0.2s;">
                <i class="fas fa-users"></i> Comunidade
            </a>
            <a href="{% url 'informacoes' %}" class="btn" style="background: white; border: 2px solid var(--accent); color: var(--accent-dark); text-decoration: none; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 600; transition: all 0.2s;">
                <i class="fas fa-info-circle"></i> Informações
            </a>
            <a href="{% url 'logout' %}" class="btn" style="background: var(--danger); color: white; text-decoration: none; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 600; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2); transition: all 0.2s;">
                <i class="fas fa-sign-out-alt"></i> Sair
            </a>
        </div>
    </div>

    <!-- Vídeos de Exercícios (Colapsável) -->
    <div class="panel" style="background: white;">
        <button onclick="toggleSection('exercicios')" style="width: 100%; display: flex; align-items: center; justify-content: space-between; background: none; border: none; cursor: pointer; padding: 0; text-align: left;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <i class="fas fa-running" style="font-size: 2.5rem; color: var(--success);"></i>
                <h2 style="font-size: 1.5rem; color: var(--success); margin: 0;">Exercícios Físicos</h2>
            </div>
            <i id="icon-exercicios" class="fas fa-chevron-down" style="font-size: 1.5rem; color: var(--success); transition: transform 0.3s;"></i>
        </button>
        <p style="color: var(--text-secondary); margin: 1rem 0;">
            <i class="fas fa-heart" style="color: var(--success);"></i> Mantenha-se ativo com exercícios simples que você pode fazer em casa.
        </p>
        <div id="section-exercicios" style="display: none; margin-top: 1.5rem;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
            <!-- Exercício 1 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/exercicio1.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: var(--success); margin-bottom: 0.5rem;"><i class="fas fa-dumbbell"></i> Exercício 1</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Alongamento básico</p>
                </div>
            </div>

            <!-- Exercício 2 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/exercicio2.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: var(--success); margin-bottom: 0.5rem;"><i class="fas fa-walking"></i> Exercício 2</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Caminhada em casa</p>
                </div>
            </div>

            <!-- Exercício 3 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/exercicio3.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: var(--success); margin-bottom: 0.5rem;"><i class="fas fa-heartbeat"></i> Exercício 3</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Fortalecimento</p>
                </div>
            </div>

            <!-- Exercício 4 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/exercicio4.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: var(--success); margin-bottom: 0.5rem;"><i class="fas fa-swimmer"></i> Exercício 4</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Respiração e relaxamento</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Vídeos de Anúncios Públicos (Colapsável) -->
    <div class="panel" style="background: white;">
        <button onclick="toggleSection('anuncios')" style="width: 100%; display: flex; align-items: center; justify-content: space-between; background: none; border: none; cursor: pointer; padding: 0; text-align: left;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <i class="fas fa-bullhorn" style="font-size: 2.5rem; color: #f59e0b;"></i>
                <h2 style="font-size: 1.5rem; color: #f59e0b; margin: 0;">Anúncios Públicos</h2>
            </div>
            <i id="icon-anuncios" class="fas fa-chevron-down" style="font-size: 1.5rem; color: #f59e0b; transition: transform 0.3s;"></i>
        </button>
        <p style="color: var(--text-secondary); margin: 1rem 0;">
            <i class="fas fa-info-circle" style="color: #f59e0b;"></i> Campanhas e informações importantes de saúde pública.
        </p>
        <div id="section-anuncios" style="display: none; margin-top: 1.5rem;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
            <!-- Anúncio 1 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/anuncio1.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: #f59e0b; margin-bottom: 0.5rem;"><i class="fas fa-megaphone"></i> Anúncio 1</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Campanha de prevenção</p>
                </div>
            </div>

            <!-- Anúncio 2 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/anuncio2.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: #f59e0b; margin-bottom: 0.5rem;"><i class="fas fa-newspaper"></i> Anúncio 2</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Informações de saúde pública</p>
                </div>
            </div>

            <!-- Anúncio 3 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/anuncio3.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: #f59e0b; margin-bottom: 0.5rem;"><i class="fas fa-bell"></i> Anúncio 3</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Avisos importantes</p>
                </div>
            </div>

            <!-- Anúncio 4 -->
            <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;">
                <div class="video-container" style="background: #000;">
                    <video 
                        controls 
                        controlsList="nodownload"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
                        preload="metadata">
                        <source src="{% static 'videos/anuncio4.mp4' %}" type="video/mp4">
                        Seu navegador não suporta a reprodução de vídeos.
                    </video>
                </div>
                <div style="padding: 1rem;">
                    <h4 style="color: #f59e0b; margin-bottom: 0.5rem;"><i class="fas fa-bullhorn"></i> Anúncio 4</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Comunicados oficiais</p>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Dicas de Saúde -->
    <div class="panel" style="background: linear-gradient(135deg, rgba(0, 217, 181, 0.05), rgba(0, 217, 181, 0.1)); border-left: 4px solid var(--accent);">
        <h3 style="color: var(--accent-dark); margin-bottom: 1.5rem; font-size: 1.3rem; text-align: left;"><i class="fas fa-lightbulb"></i> Dica do Dia</h3>
        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
            <p style="color: var(--text-secondary); line-height: 1.7; font-size: 1rem; text-align: left;">
                <strong style="color: var(--accent-dark);">Hidrate-se regularmente!</strong><br>
                Beber água é fundamental para o bom funcionamento do seu organismo. Mantenha uma garrafa de água por perto e beba pequenos goles ao longo do dia. A hidratação adequada ajuda na absorção de medicamentos e melhora o funcionamento de todos os órgãos.
            </p>
        </div>
    </div>

    <!-- Lembretes Rápidos -->
    <div class="panel" style="background: white;">
        <h3 style="color: var(--accent-dark); margin-bottom: 1.5rem; font-size: 1.3rem; text-align: left;"><i class="fas fa-clipboard-list"></i> Lembretes Importantes</h3>
        <div style="display: grid; gap: 1rem;">
            <div style="background: linear-gradient(135deg, #f9fafb, #ffffff); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--accent);">
                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem; text-align: left;">Tome seus medicamentos nos horários corretos</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem; text-align: left;">Configure alarmes para não esquecer</p>
            </div>
            
            <div style="background: linear-gradient(135deg, #f9fafb, #ffffff); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--success);">
                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem; text-align: left;">Não falte às suas consultas</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem; text-align: left;">O acompanhamento médico é essencial</p>
            </div>
            
            <div style="background: linear-gradient(135deg, #f9fafb, #ffffff); padding: 1rem; border-radius: 8px; border-left: 3px solid #3b82f6;">
                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.25rem; text-align: left;">Mantenha uma alimentação saudável</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem; text-align: left;">Seu corpo agradece!</p>
            </div>
        </div>
    </div>
</div>

<style>
/* Estilos dos Vídeos */
.video-container {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    background: #000;
    border-radius: 8px;
}

.video-container video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
    object-fit: contain;
}

.video-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    color: var(--text-secondary);
    text-align: center;
    padding: 2rem;
}

.video-placeholder i {
    font-size: 3rem;
    color: var(--muted);
    margin-bottom: 1rem;
}

.video-placeholder p {
    font-size: 0.95rem;
    line-height: 1.6;
    max-width: 250px;
}

.panel:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12) !important;
}
</style>

<script>
// Adiciona tratamento de erro para vídeos não encontrados
document.addEventListener('DOMContentLoaded', function() {
    const videos = document.querySelectorAll('video');
    videos.forEach(function(video) {
        // Tratamento de erro quando o vídeo não carrega
        video.addEventListener('error', function(e) {
            console.log('Erro ao carregar vídeo:', video.src);
            const container = video.closest('.video-container');
            if (container) {
                video.style.display = 'none';
                
                // Cria elemento de placeholder se não existir
                let placeholder = container.querySelector('.video-placeholder');
                if (!placeholder) {
                    placeholder = document.createElement('div');
                    placeholder.className = 'video-placeholder';
                    placeholder.innerHTML = `
                        <i class="fas fa-video-slash"></i>
                        <p><strong>Vídeo não disponível</strong><br>Este conteúdo está sendo preparado e estará disponível em breve.</p>
                    `;
                    container.appendChild(placeholder);
                }
                placeholder.style.display = 'flex';
            }
        }, true);
        
        // Força verificação após carregamento da página
        video.load();
    });
});

// Toggle de Seções (fora do DOMContentLoaded)
function toggleSection(sectionId) {
    const section = document.getElementById('section-' + sectionId);
    const icon = document.getElementById('icon-' + sectionId);
    
    if (section.style.display === 'none' || section.style.display === '') {
        section.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
    } else {
        section.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
    }
}
</script>
{% endblock %}
